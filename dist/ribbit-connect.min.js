(()=>{"use strict";const e={resize:!1,closeButton:!1,mobileWidth:650,canOpenNewWindows:!0};class n{settings={};CONNECTEvents=["launch","exit","complete","bankLoginSelected","manualEnrollmentSelected","noAccountsFound","bankNotFound","bankLogin","bankManual","linkOpen"];#e=[];#n=380;#t=640;#i=null;#s=!1;constructor({token:n,language:t="en",width:i=380,settings:s,inline:a,fullscreen:o=!1,environment:l="Production",environmentOverrideURL:r}){this.token=n,this.id="RIBBIT-"+this.token,this.settings={...e,...s},this.#n=i>380?i:380,this.#t=Math.min(640,.9*window.innerHeight),this.isMobile=window.innerWidth<=this.settings.mobileWidth,this.isInline=!0===a,this.fullscreen=o,this.language=t,this.environment=l,this.environmentOverrideURL=r,this.#s||this.initFrame(),this.sendMessage("isMobile",this.isMobile),this.sendMessage("isInline",this.isInline),this.#a()}initFrame=()=>{this.#s=!0;const e=document.createElement("iframe");let n="";if(this.environmentOverrideURL)n=this.environmentOverrideURL;else switch(this.environment){case"Production":n="https://portal.ribbit.ai";break;case"Development":n="https://playground.ribbit.ai";break;case"Test":case"Staging":n="https://test.ribbit.ai"}this.iFrameMessageKey=(new Date).getTime()+"",e.setAttribute("src",n+"/CONNECT/Frame?token="+this.token+"&language="+this.language+"&messagekey="+this.iFrameMessageKey),e.id=this.id,this.iFrame=e,this.updateClassName(),this.#o(),this.#l(),this.#a(),window.addEventListener("resize",(e=>{let n=window.innerWidth<=this.settings.mobileWidth;this.sendMessage("resize",{width:window.innerWidth,height:window.innerHeight}),n!=this.isMobile&&(this.isMobile=n,this.sendMessage("isMobile",this.isMobile),this.updateClassName())}),!0)};onCallbacks=[];on=(e,n)=>{this.onCallbacks.push({eventName:e,callback:n})};updateClassName=()=>{this.iFrame.className="RIBBIT-iFrame"+(this.isMobile||this.fullscreen?" RIBBIT-iFrame-mobile":"")+(this.fullscreen?" RIBBIT-iFrame-fullscreen":"")};#l=()=>{this.#i=document.createElement("style"),this.#i.type="text/css",document.getElementsByTagName("head")[0].appendChild(this.#i)};#a=()=>{const e=`\n            #${this.id} {\n                ${this.#t?"height: "+this.#t+"px;":""}\n                width: ${this.#n}px;\n            }\n        `;this.#i.styleSheet?this.#i.styleSheet.cssText=e:(this.#i.innerHTML="",this.#i.appendChild(document.createTextNode(e)))};sendMessage=(e,n)=>{let t=document.getElementById(this.id);t&&t.contentWindow.postMessage({function:e,message:n},"*")};#o=()=>{window.removeEventListener("message",this.#r),window.addEventListener("message",this.#r,!1)};#r=e=>{const n=e.data.function,t=e.data.message,i=e.data.key;if(n&&i===this.iFrameMessageKey)switch(n){case"heightChange":if(0==this.settings.resize)return;this.#t=t,this.#a();break;case"openLink":this.settings.canOpenNewWindows?window.open(t,"_blank").focus():this.onCallbacks.filter((e=>"linkOpen"==e.eventName)).map((e=>e.callback(t)));break;case"CONNECTEvent":this.#e.map((e=>e(n,t))),this.onCallbacks.filter((e=>e.eventName==t.name)).map((e=>e.callback(t)));break;case"environmentCheck":this.sendMessage("isMobile",window.innerWidth<=this.settings.mobileWidth),this.sendMessage("isInline",this.isInline);break;case"startupParams":this.sendMessage("startupParams",{token:this.token,settings:this.settings,isMobile:this.isMobile,isInline:this.isInline,fullscreen:this.fullscreen,language:this.language,environment:this.environment,environmentOverrideURL:this.environmentOverrideURL})}};onMessage=e=>{this.#e.push(e)}}function t(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var a=i((function e(t){var i=this,a=t.target,o=t.token,l=t.language,r=t.inline,p=void 0!==r&&r,h=t.fullscreen,c=void 0!==h&&h,d=t.settings,u=void 0===d?{}:d,m=t.className,g=t.environment,I=t.environmentOverrideURL,B=t.open,b=void 0!==B&&B;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"initialized",!1),s(this,"parent",null),s(this,"open",!1),s(this,"popupElement",null),s(this,"inlineElement",null),s(this,"messageCallbacks",[]),s(this,"init",(function(){i.initialized||(i.parent=document.getElementById(i.targetId),i.inline?i.initInline():i.initPopup(),i.initStyles(),i.RIBBITConnectContext.CONNECTEvents.map((function(e){var n=e.charAt(0).toUpperCase()+e.slice(1);i["on"+n]=function(n){i.RIBBITConnectContext.on(e,n)}})),i.RIBBITConnectContext.onMessage((function(e,n){i.messageCallbacks.map((function(t){"CONNECTEvent"!=e&&0==t.getAllMessages||t.callback(e,n)}))})))})),s(this,"initPopup",(function(){i.popupElement=document.createElement("div");var e=document.createElement("div");e.className="RIBBIT-popup-curtain",i.curtainColor&&(e.style.backgroundColor=i.curtainColor),i.popupElement.appendChild(e),i.element=i.popupElement,i.popupElement.appendChild(i.RIBBITConnectContext.iFrame),i.popupElement.addEventListener("click",i.closePopup),i.parent.appendChild(i.popupElement),i.updateClassName()})),s(this,"initStyles",(function(){var e=document.createElement("style");e.innerHTML="\n.RIBBIT-iFrame {\n    margin: auto;\n    border-radius: 10px;\n    border: 0px transparent;\n}\n.RIBBIT-popup {\n    position: fixed;\n    top: 0px;\n    left: 0px;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    z-index: 10;\n}\n.RIBBIT-popup.RIBBIT-popup-popup {\n    pointer-events: none;\n    opacity: 0;\n    transition: opacity 300ms;\n}\n.RIBBIT-popup.RIBBIT-popup-popup .RIBBIT-iFrame {\n    transform: translateY(50vh) scale(0.9);\n    transition: transform 500ms;\n}\n.RIBBIT-popup.RIBBIT-popup-popup.RIBBIT-popup-open {\n    pointer-events: all;\n    opacity: 1;\n}\n.RIBBIT-popup.RIBBIT-popup-popup.RIBBIT-popup-open .RIBBIT-iFrame {\n    transform: translateY(0vh) scale(1);\n}\n.RIBBIT-popup .RIBBIT-iFrame {\n    position: relative;\n    z-index: 2;\n}\n.RIBBIT-popup .RIBBIT-iFrame.RIBBIT-iFrame-mobile {\n    width: 100% !important;\n    height: 98% !important;\n    max-width: none !important;\n    max-height: none !important;\n    bottom: 0px;\n    position: absolute;\n    border-top-left-radius: 10px;\n    border-top-right-radius: 10px;\n    border-bottom-left-radius: 0;\n    border-bottom-right-radius: 0;\n    box-shadow: 0 -2px 10px #000;\n}\n.RIBBIT-popup .RIBBIT-iFrame-fullscreen.RIBBIT-iFrame-fullscreen {\n    width: 100%;\n    height: 100% !important;\n    max-width: none !important;\n    max-height: none !important;\n    border-top-left-radius: 0px;\n    border-top-right-radius: 0px;\n}\n.RIBBIT-popup .RIBBIT-popup-curtain {\n    position: absolute;\n    z-index: 1;\n    top: 0px;\n    left: 0px;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.5);\n}\n",document.head.appendChild(e)})),s(this,"initInline",(function(){i.inlineElement=document.createElement("div"),i.inlineElement.appendChild(i.RIBBITConnectContext.iFrame),i.parent.appendChild(i.inlineElement)})),s(this,"updateClassName",(function(){i.element.className="RIBBIT-popup ".concat(i.className?" "+i.className+" ":""," ").concat(i.isOpen?" RIBBIT-popup-open":""," ").concat(i.inline?" RIBBIT-popup-inline":" RIBBIT-popup-popup")})),s(this,"onMessage",(function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];messageCallbacks.push({callback:e,getAllMessages:n})})),s(this,"open",(function(){i.isOpen=!0,i.updateClassName()})),s(this,"close",(function(){i.isOpen=!1,i.updateClassName()})),s(this,"closePopup",(function(){i.curtainAllowClose&&i.RIBBITConnectContext.sendMessage("exit",null)})),this.targetId=a,this.token=o,this.language=l,this.inline=p,this.settings=u,this.className=m,this.isOpen=b,this.curtainColor=u.curtainColor,this.curtainAllowClose=u.curtainAllowClose||!0,this.RIBBITConnectContext=new n({token:o,settings:u,inline:p,fullscreen:c,language:l,environment:g,environmentOverrideURL:I}),this.init()}));!function(e,n){e.RIBBITConnect=a}(window,document)})();